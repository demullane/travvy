<%= form_tag '/search', {:method => 'get', :id => 'search_form', :class => 'form-horizontal'} do %>
  <div class = 'form-group'>
    <%= label_tag :location_input, 'Search by Location', class: 'control-label col-md-2' %>
    <div class = 'form-controls col-md-4'>
      <%= text_field_tag :location_input, nil, class: 'form-control', placeholder: 'Please enter a location...' %>
    </div>
    <span id = 'location_input_errors'></span>
  </div>
  <div class = 'form-group'>
    <%= label_tag :arrival_date, 'Arrival Date', class: 'control-label col-md-2' %>
    <div class = 'form-controls col-md-4'>
      <div class = 'input-group date' id='arrival_date_picker'>
        <%= text_field_tag :arrival_date, nil, class: 'form-control', placeholder: 'Please select a date...' %>
        <span class = 'input-group-addon'>
            <span class = 'glyphicon glyphicon-calendar'></span>
        </span>
      </div>
    </div>
    <span id = 'arrival_date_errors'></span>
  </div>
  <div class = 'form-group'>
    <%= label_tag :departure_date, 'Departure Date', class: 'control-label col-md-2' %>
    <div class = 'form-controls col-md-4'>
      <div class = 'input-group date' id='departure_date_picker'>
        <%= text_field_tag :departure_date, nil, class: 'form-control', placeholder: 'Please select a date...', disabled: false %>
        <span class = 'input-group-addon'>
            <span class = 'glyphicon glyphicon-calendar'></span>
        </span>
      </div>
    </div>
    <span id = 'departure_date_errors'></span>
  </div>
  <div class = 'form-group'>
    <%= label_tag :guest_count, 'Number of Adults', class: 'control-label col-md-2' %>
    <div class = 'form-controls col-md-4'>
      <%= select_tag :guest_count, options_for_select([1,2,3,4,5,6,7,8]), class: 'form-control' %>
    </div>
    <span id = 'guest_count_errors'></span>
  </div>
  <div class = 'form-group'>
    <%= label_tag :search_filter, 'Filter', class: 'control-label col-md-2' %>
    <div class = 'form-controls col-md-4'>
      <%= select_tag :search_filter, options_for_select(['Distance', 'Price']), class: 'form-control' %>
    </div>
    <span id = 'guest_count_errors'></span>
  </div>
  <div class = 'form-group'>
    <div class = 'col-md-offset-2 col-md-4'>
    <%= submit_tag "Search", class: 'btn btn-primary form-control', id: 'search-button' %>
    </div>
  </div>
<% end %>

<div class = 'col-md-6'>
  <% if @location_data %>
    <p><%= @location_data %></p>
    <p>Location: <%= @location_input %>
    <br>Arrival: <%= @arrival_date %>
    <br>Departure: <%= @departure_date %></p>
    <% if @hotel_error_message %>
      <div><%= @hotel_error_message %></div>
    <% elsif @hotel_results %>
      <div class='listings'>
        <ol>
          <% @hotel_results.each_with_index do |listing, index| %>
            <div>
              <li>
                <strong>
                  <%= link_to listing[:title], listing[:link], target: '_blank' %>
                </strong>
              </li><br>
              Price: <%= listing[:price] %><br>
              Location: <%= listing[:location_description] %><br>
              Latitude: <%= listing[:latitude] %><br>
              Longitude: <%= listing[:longitude] %><br>
              Distance: <%= listing[:distance] %> miles<br>
            </div>
            <br />
          <% end %>
        </ol>
      </div>
    <% end %>
  <% end %>
</div>

<div class = 'col-md-6'>
  <% if @location_data %>
    <p><%= @location_data %></p>
    <p>Location: <%= @location_input %>
    <br>Arrival: <%= @arrival_date %>
    <br>Departure: <%= @departure_date %></p>
    <div class='listings'>
      <ol>
        <% @airbnb_results.each_with_index do |listing, index| %>
          <div>
            <li>
              <strong>
                <%= link_to listing[:title], listing[:link], target: '_blank' %>
              </strong>
            </li><br>
            Price: <%= listing[:price] %><br>
            Location: <%= listing[:location_description] %><br>
            Latitude: <%= listing[:latitude] %><br>
            Longitude: <%= listing[:longitude] %><br>
            Distance: <%= listing[:distance] %> miles<br>
          </div>
          <br />
        <% end %>
      </ol>
    </div>
  <% end %>
</div>

<script>
  $('#location_input').geocomplete();

  // Trigger geocoding request.
  $('button.find').click(function(){
    $('input').trigger('geocode');
  });

  $(function () {
    $('#arrival_date_picker').datetimepicker({
      viewMode: 'days',
      format: 'MM/DD/YYYY',
      minDate: moment()
    });

    $('#departure_date_picker').datetimepicker({
      viewMode: 'days',
      format: 'MM/DD/YYYY',
      minDate: moment()
    });
    $('#arrival_date_picker').on('dp.change', function (e) {
      $('#departure_date_picker').data('DateTimePicker').minDate(e.date);
      $('#departure_date_picker').data('DateTimePicker').disabledDates([e.date]);
    });
    $('#departure_date_picker').on('dp.change', function (e) {
      $('#arrival_date_picker').data('DateTimePicker').maxDate(e.date);
    });
  });
</script>
